<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SWS/OPS ç³»çµ±</title>
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/5968/5968313.png">

  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, collection, query, where, getDocs, addDoc, serverTimestamp, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // ä½ æä¾›çš„ Config
    const firebaseConfig = {
      apiKey: "AIzaSyDTT86mpGJJMByToRMi7b8jjI0LoNJarNo",
      authDomain: "sws-ops.firebaseapp.com",
      projectId: "sws-ops",
      storageBucket: "sws-ops.firebasestorage.app",
      messagingSenderId: "985280948590",
      appId: "1:985280948590:web:3aad1539136659b4dc797f",
      measurementId: "G-3SJVX49Q9C"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- å…¨åŸŸè®Šæ•¸ ---
    let currentUser = null;

    // --- ä»‹é¢æ§åˆ¶ ---
    const showPage = (id) => {
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      window.scrollTo(0,0);
    };

    // --- ç™»å…¥åŠŸèƒ½ ---
    window.doLogin = async () => {
      const name = document.getElementById('loginName').value.trim();
      const pin = document.getElementById('loginPin').value.trim();
      const btn = document.getElementById('loginBtn');
      
      if(!name || !pin) return alert('è«‹è¼¸å…¥å§“ååŒ PIN');
      
      btn.disabled = true;
      btn.innerText = 'ç™»å…¥ä¸­...';

      try {
        const q = query(collection(db, "employees"), where("name", "==", name), where("pin", "==", pin));
        const querySnapshot = await getDocs(q);
        
        if (!querySnapshot.empty) {
          currentUser = { id: querySnapshot.docs[0].id, ...querySnapshot.docs[0].data() };
          localStorage.setItem('sws_user', JSON.stringify(currentUser));
          renderDashboard();
        } else {
          alert('å§“åæˆ– PIN éŒ¯èª¤');
        }
      } catch (e) {
        console.error(e);
        alert('ç™»å…¥å‡ºéŒ¯ï¼Œè«‹æª¢æŸ¥ç¶²è·¯');
      } finally {
        btn.disabled = false;
        btn.innerText = 'ç™»å…¥';
      }
    };

    // --- ä¸»ä»‹é¢æ¸²æŸ“ ---
    window.renderDashboard = () => {
      document.getElementById('userName').innerText = currentUser.name;
      if(currentUser.role === 'admin') {
        document.getElementById('adminBtn').classList.remove('hidden');
      }
      showPage('pageDashboard');
    };

    // --- ç™»å‡º ---
    window.doLogout = () => {
      localStorage.removeItem('sws_user');
      location.reload();
    };

    // å•Ÿå‹•æª¢æŸ¥
    window.onload = () => {
      const saved = localStorage.getItem('sws_user');
      if(saved) {
        currentUser = JSON.parse(saved);
        renderDashboard();
      } else {
        showPage('pageLogin');
      }
    };
  </script>

  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    .page { min-height: 100vh; background-color: #f3f4f6; }
    .btn-primary { @apply w-full bg-blue-600 text-white py-4 rounded-xl font-bold active:scale-95 transition-all shadow-lg; }
  </style>
</head>
<body class="antialiased text-gray-900">

  <div id="pageLogin" class="page flex items-center justify-center px-6 hidden">
    <div class="w-full max-w-md bg-white p-8 rounded-3xl shadow-2xl">
      <h1 class="text-3xl font-black text-center mb-8 text-blue-600">SWS / OPS</h1>
      <div class="space-y-4">
        <input id="loginName" type="text" placeholder="å“¡å·¥å§“å" class="w-full p-4 border-2 border-gray-100 rounded-xl focus:border-blue-500 outline-none">
        <input id="loginPin" type="password" inputmode="numeric" placeholder="6 ä½ PIN ç¢¼" class="w-full p-4 border-2 border-gray-100 rounded-xl focus:border-blue-500 outline-none">
        <button id="loginBtn" onclick="doLogin()" class="btn-primary text-lg">ç™»å…¥</button>
      </div>
    </div>
  </div>

  <div id="pageDashboard" class="page hidden">
    <nav class="bg-white px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-10">
      <span class="font-bold text-xl text-blue-600">SWS ç³»çµ±</span>
      <button onclick="doLogout()" class="text-gray-400 text-sm">ç™»å‡º</button>
    </nav>
    
    <div class="p-6 space-y-6">
      <div class="bg-gradient-to-br from-blue-500 to-blue-700 p-6 rounded-3xl text-white shadow-lg">
        <p class="opacity-80">æ­¡è¿è¿”åšŸ,</p>
        <h2 id="userName" class="text-3xl font-bold">-</h2>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <button class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center space-y-2 active:bg-gray-50">
          <span class="text-3xl">ğŸ“</span>
          <span class="font-bold text-gray-700">è¿”å·¥æ‰“å¡</span>
        </button>
        <button class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center space-y-2 active:bg-gray-50">
          <span class="text-3xl">ğŸ </span>
          <span class="font-bold text-gray-700">æ”¾å·¥æ‰“å¡</span>
        </button>
      </div>

      <button id="adminBtn" class="hidden w-full bg-amber-100 text-amber-700 py-4 rounded-2xl font-bold flex items-center justify-center space-x-2">
        <span>âš™ï¸</span>
        <span>ç®¡ç†å“¡ä»‹é¢ (æ‰‹æ©Ÿå°ˆç”¨)</span>
      </button>
    </div>
  </div>

</body>
</html>
