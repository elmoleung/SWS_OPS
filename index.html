<!DOCTYPE html>
<html><head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SWS/OPSå“¡å·¥æ‰“å¡ç³»çµ±</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/5968/5968313.png">
<style>:root { --primary: #000; --bg: #f2f2f7; --success: #34c759; --blue: #007aff; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin:0; font-family:-apple-system, 'SF Pro Display', sans-serif; background: var(--bg); color: #1c1c1e; }
.card {background:white; width:92%; max-width:400px; padding:25px;
border-radius:28px; box-shadow:0 10px 30px rgba(0,0,0,0.08);
text-align:center; margin: 20px auto; display: none;
}.active { display: block !important; animation: fadeIn 0.2s ease-out; }
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
h2 { margin-bottom:20px; font-size:22px; font-weight:700; }
button { width:100%; padding:18px; border-radius:16px; border:none; background:var(--primary); color:white; font-size:16px; font-weight:600; margin-top:10px; cursor:pointer; }
button:active { opacity: 0.7; transform: scale(0.98); }
button:disabled { background: #ccc !important; }
.secondary { background:#e5e5e7; color:#000; }
.home-link { color: var(--blue); cursor: pointer; display: block; margin-top: 15px; font-size: 15px; font-weight: 600; text-decoration: none; }
#btnIn { background: #FFFBCC; color: #856404; border: 1px solid #ffeeba; }
#btnOut { background: #CCE5FF; color: #004085; border: 1px solid #b8daff; }
.menu-btn { text-align:left; padding:18px; background:#fff; margin-bottom:12px; border-radius:18px; border:1px solid #eee; display:flex; justify-content:space-between; align-items:center; cursor:pointer; }
.record-item { text-align:left; padding:15px; border-bottom:1px solid #f2f2f7; font-size:14px; position: relative; }
input, textarea { width:100%; padding:18px; margin-bottom:15px; border-radius:16px; border:1.5px solid #d1d1d6; font-size:16px; outline:none; }
.loading-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:9999; justify-content:center; align-items:center; backdrop-filter: blur(3px); }
</style>
</head>
<body>
<div id="loading" class="loading-overlay"><b>âŒ› è™•ç†ä¸­...</b></div>

<div class="card active" id="loginBox">
<div style="font-size: 50px; margin-bottom: 15px;">ğŸ’¼</div>
<h2>SWS/OPS æ‰“å¡ç³»çµ±</h2>
<input id="name" placeholder="ç™»å…¥åç¨±" autocomplete="off">
<input id="pin" type="password" placeholder="PINç¢¼" inputmode="numeric">
<button id="loginBtn">ç™»å…¥ç³»çµ±</button>
</div>

<div class="card" id="menuBox">
<h2 id="userHello">ä½ å¥½</h2>
<div class="menu-btn" onclick="showBox('clockInBox')"><div>ğŸ“ <b>æˆ‘è¦æ‰“å¡ï¼</b></div><span>â¯</span></div>
<div class="menu-btn"><div>ğŸ“… <b>æˆ‘æƒ³ç‡æ›´ï¼</b></div><span>â¯</span></div>
<div class="menu-btn"><div>ğŸ“œ <b>æ‰“å¡ç´€éŒ„</b></div><span>â¯</span></div>
<button class="secondary" id="logoutBtn" style="margin-top:20px;">ç™»å‡ºç³»çµ±</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDTT86mpGJJMByToRMi7b8jjI0LoNJarNo",
  authDomain: "sws-ops.firebaseapp.com",
  projectId: "sws-ops",
  storageBucket: "sws-ops.firebasestorage.app",
  messagingSenderId: "985280948590",
  appId: "1:985280948590:web:3aad1539136659b4dc797f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// å…¨åŸŸå°èˆª
window.showBox = (id) => {
  document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
  document.getElementById(id).classList.add('active');
};

// ç™»å…¥é‚è¼¯
document.getElementById('loginBtn').onclick = async () => {
  const n = document.getElementById("name").value.trim();
  const p = document.getElementById("pin").value.trim();
  if(!n || !p) return;
  
  const btn = document.getElementById("loginBtn");
  btn.innerText = "é©—è­‰ä¸­...";
  btn.disabled = true;

  try {
    const q = query(collection(db, "employees"), where("name", "==", n), where("pin", "==", p));
    const snap = await getDocs(q);
    if(!snap.empty) {
      const user = snap.docs[0].data();
      localStorage.setItem('sws_user', JSON.stringify(user));
      document.getElementById("userHello").innerText = "ä½ å¥½ï¼Œ" + user.name;
      showBox('menuBox');
    } else {
      alert("å§“åæˆ–PINç¢¼éŒ¯èª¤");
    }
  } catch(e) {
    alert("é€£ç·šå‡ºéŒ¯");
  } finally {
    btn.innerText = "ç™»å…¥ç³»çµ±";
    btn.disabled = false;
  }
};

document.getElementById('logoutBtn').onclick = () => {
  localStorage.removeItem('sws_user');
  location.reload();
};

// æª¢æŸ¥è‡ªå‹•ç™»å…¥
const saved = localStorage.getItem('sws_user');
if(saved) {
  const user = JSON.parse(saved);
  document.getElementById("userHello").innerText = "ä½ å¥½ï¼Œ" + user.name;
  showBox('menuBox');
}
</script>
</body></html>
